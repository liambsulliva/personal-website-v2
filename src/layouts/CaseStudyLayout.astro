---
// @ts-ignore
import { localizePath } from "astro-i18next";
import Layout from "./Layout.astro";
import BackLink from "../components/BackLink.astro";
import SideBar from "../components/SideBar.astro";
import ProjectDescription from "../components/ProjectDescription.astro";
import Footer from "./Footer.astro";

interface Props {
  title: string;
  subtitle: string;
  pageTitle: string;
  sidebarItems: { text: string; href: string }[];
  projectRole: string[];
  team: string[];
  tools: string[];
  timeline: string[];
  demoLink?: string;
  githubLink?: string;
  sidebarClassName?: string;
  isCaseStudy?: boolean;
}

const {
  title,
  subtitle,
  pageTitle,
  sidebarItems,
  projectRole,
  team,
  tools,
  timeline,
  demoLink,
  githubLink,
  sidebarClassName = "fixed right-[calc((100vw-1150px)/2-7rem)] top-56",
  isCaseStudy = false,
}: Props = Astro.props;
---

<Layout title={pageTitle}>
  <div class="m-8">
    <BackLink label={"Back"} href={localizePath("/")} />
  </div>
  <main class="mx-auto flex w-[1150px] max-w-full flex-row">
    <SideBar navItems={sidebarItems} className={sidebarClassName} />
    <div class="mb-20">
      <h1 class="mt-4 text-center text-5xl font-bold text-white">
        {title}
      </h1>
      <h2 class="mb-8 text-center text-[1rem] text-[#d0d0d0]">
        {subtitle}
      </h2>

      <!-- Hero slot for Book component or banner images -->
      <slot name="hero" />

      <ProjectDescription
        projectRole={projectRole}
        team={team}
        tools={tools}
        timeline={timeline}
        demoLink={isCaseStudy ? undefined : demoLink}
        githubLink={isCaseStudy ? undefined : githubLink}
      />

      <!-- Main content slots -->
      <slot />
    </div>
  </main>
  <Footer />
</Layout>

<style>
  /* Broken on Safari... disable for now */
  @supports (hanging-punctuation: first) and (font: -apple-system-body) and
    (-webkit-appearance: none) {
    .mockup-container,
    .mockup-content,
    .mockup-phone {
      display: none;
    }
  }

  .mockup-container {
    position: relative;
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
    aspect-ratio: 9/16;
  }

  .mockup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    height: auto;
    aspect-ratio: 9/16;
    overflow-y: auto;
    z-index: 1;
    scrollbar-width: none; /* Firefox */
  }

  .mockup-content::-webkit-scrollbar {
    display: none; /* Chrome, Safari and Opera */
  }

  .mockup-phone {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    z-index: 2;
    pointer-events: none;
    aspect-ratio: 9/16;
  }

  @media (max-width: 1024px) {
    .mockup-content {
      transform: translate(-155px, -50%);
    }
  }

  .text-link {
    color: var(--header-color);
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    position: relative;
  }
  .text-link:after {
    bottom: 0;
    content: "";
    height: 2px;
    left: 50%;
    position: absolute;
    background: var(--header-color);
    transition:
      width 0.2s ease 0s,
      left 0.2s ease 0s;
    width: 0;
  }
  .text-link:hover:after {
    width: 100%;
    left: 0;
  }

  :global(.case-study-layout) h3,
  :global(.case-study-layout) h4,
  :global(.case-study-layout) h5,
  :global(.case-study-layout) h6,
  :global(.case-study-layout) p {
    margin: 0;
    text-align: left;
  }

  :global(.case-study-layout) h3 {
    margin-bottom: 1rem;
  }

  :global(.case-study-layout) li {
    color: #d0d0d0;
    list-style-type: disc;
    margin-left: 1.25rem;
    padding: 0.25rem;
  }

  :global(.case-study-layout) iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  :global(.case-study-layout) section {
    padding: 2rem;
  }

  :global(.case-study-layout) h2 {
    margin-bottom: 1rem;
  }

  :global(.case-study-layout) p {
    line-height: 1.6;
    color: var(--text-color);
  }

  @media (max-width: 1000px) {
    main {
      flex-direction: column;
      width: 100%;
    }

    :global(.sidebar) {
      display: none;
    }
  }

  :global(.case-study-layout) .card-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: space-between;
  }

  :global(.case-study-layout) .card {
    background-color: var(--card-color);
    border: 1px solid #333;
    border-radius: 0.75rem;
    padding: 1.5rem;
    width: calc(33.33% - 0.67rem);
    margin-bottom: 1rem;
  }

  :global(.case-study-layout) .card h4 {
    margin-bottom: 0.5rem;
  }

  @media (max-width: 768px) {
    :global(.case-study-layout) .card {
      width: 100%;
    }
  }

  :global(.case-study-layout) .row-card-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  :global(.case-study-layout) .row-card {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    background-color: var(--card-color);
    border: 1px solid #333;
    border-radius: 0.75rem;
    padding: 1rem;
    width: 100%;
    margin-bottom: 1rem;
  }

  :global(.case-study-layout) code {
    background-color: #2d2d2d;
    color: #f8f8f2;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: "Courier New", Courier, monospace;
  }

  :global(.case-study-layout) pre {
    background-color: #1e1e1e;
    color: #d4d4d4;
    padding: 1rem;
    border-radius: 8px;
    overflow: auto;
    text-align: left;
    white-space: pre-wrap;
    word-break: break-word;
  }

  :global(.case-study-layout) .fade-in {
    opacity: 0;
    transition: opacity 0.5s ease-out;
  }

  :global(.case-study-layout) .fade-in.visible {
    opacity: 1;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const elements = document.querySelectorAll(".fade-in");

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    });

    elements.forEach((element) => observer.observe(element));
  });
</script>
