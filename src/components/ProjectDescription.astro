---
import Button from "./Button.astro";
import Badge from "./Badge.astro";
import {
  ReactIcon,
  TypeScriptIcon,
  NextjsIcon,
  NodejsIcon,
  TailwindIcon,
  AstroIcon,
  SvelteIcon,
  MongoDBIcon,
} from "../utils/icons";

interface Props {
  projectRole: string[];
  team: string[];
  tools: string[];
  timeline: string[];
  demoLink?: string;
  githubLink?: string;
}

const { projectRole, team, tools, timeline, demoLink, githubLink }: Props =
  Astro.props;

function getToolIcon(toolName: string) {
  const normalizedName = toolName.toLowerCase().replace(/[.\s-]/g, "");
  const iconMap: Record<string, any> = {
    react: ReactIcon,
    typescript: TypeScriptIcon,
    "next.js": NextjsIcon,
    nextjs: NextjsIcon,
    "node.js": NodejsIcon,
    nodejs: NodejsIcon,
    tailwind: TailwindIcon,
    tailwindcss: TailwindIcon,
    astro: AstroIcon,
    svelte: SvelteIcon,
    mongodb: MongoDBIcon,
  };
  return iconMap[normalizedName] || null;
}
---

<div class="project-description-container">
  <div
    class="tools-and-buttons-container mx-14 mb-12 mt-6 flex flex-wrap items-center justify-between gap-4 max-lg:flex-col max-md:mx-4 max-md:items-center"
  >
    <div
      class=`tools-badges flex min-w-0 flex-1 flex-wrap gap-2 max-lg:justify-center max-md:w-full max-md:flex-1 max-md:justify-center ${(demoLink && githubLink) ?? "justify-center"}`
    >
      {
        tools.map((tool) => {
          const IconComponent = getToolIcon(tool);
          return (
            <Badge text={tool}>
              {IconComponent ? (
                <IconComponent />
              ) : (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="2rem"
                  height="2rem"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="#e0e0e0"
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m-2 15l-5-5l1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                  />
                </svg>
              )}
            </Badge>
          );
        })
      }
    </div>
    {
      (demoLink || githubLink) && (
        <div class="buttons-container flex gap-4 max-md:justify-center">
          {githubLink && (
            <Button
              href={githubLink}
              label="GitHub"
              variant="secondary"
              ariaLabel="View on GitHub"
            >
              <svg
                slot="icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"
                />
              </svg>
            </Button>
          )}
          {demoLink && (
            <Button
              href={demoLink}
              label="Live Demo"
              variant="primary"
              ariaLabel="View Live Demo"
            >
              <svg
                slot="icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"
                />
              </svg>
            </Button>
          )}
        </div>
      )
    }
  </div>
  <div
    class="project-info-grid mb-6 mt-6 grid w-full grid-cols-1 justify-items-center gap-6 sm:grid-cols-2 md:mt-2 md:grid-cols-3 md:justify-items-stretch md:gap-4"
  >
    <div class="flex flex-col items-center text-center">
      <div>
        <h2 class="font-semibold text-white">Role</h2>
      </div>
      <ul class="list-none text-[#D0D0D0]">
        {projectRole.map((role) => <li>{role}</li>)}
      </ul>
    </div>
    <div class="flex flex-col items-center text-center">
      <div>
        <h2 class="font-semibold text-white">Team</h2>
      </div>
      <ul class="list-none text-[#D0D0D0]">
        {team.map((member) => <li>{member}</li>)}
      </ul>
    </div>
    <div class="flex flex-col items-center text-center">
      <div>
        <h2 class="font-semibold text-white">Timeline</h2>
      </div>
      <ul class="list-none text-[#D0D0D0]">
        {timeline.map((time) => <li>{time}</li>)}
      </ul>
    </div>
  </div>
</div>

<style>
  .project-description-container {
    width: 100%;
  }

  /* Pyramid-style layout: center Timeline when it wraps to its own row */
  @media (min-width: 640px) and (max-width: 767px) {
    .project-info-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .project-info-grid > div:nth-child(3) {
      grid-column: 1 / -1;
      justify-self: center;
      max-width: fit-content;
    }
  }
</style>
